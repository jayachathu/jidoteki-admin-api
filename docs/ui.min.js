  /*
    This Source Code Form is subject to the terms of the Mozilla Public
    License, v. 2.0. If a copy of the MPL was not distributed with this
    file, You can obtain one at http://mozilla.org/MPL/2.0/.

    Copyright (c) 2015-2017 Alexander Williams, Unscramble <license@unscramble.jp>
  */
(function(){"use strict";var e,t,a,o,r,s,n,i,d,l,p,u,c,g,k,f,v,b,m,h,w,j,y,C,I,P,A,T,S,q,x,D,_,N,E,F,O,M,J,R,W,z,H,B,G,L,Q,U,K,V,X=[].indexOf;t=null!=window.location.origin?window.location.origin:`${window.location.protocol}//${window.location.hostname}${null!=window.location.port?":"+window.location.port:""}`,J=function(e){var t;return $("#login-remember").is(":checked")?(864e5,30,(t=new Date).setTime(+t+2592e6),document.cookie=`jidoteki-admin-api-token=${e}; secure; expires=${t.toGMTString()}; path=/`):document.cookie=`jidoteki-admin-api-token=${e}; secure; path=/`},b=function(){return(document.cookie.match("(^|; )jidoteki-admin-api-token=([^;]*)")||0)[2]},i=function(){return document.cookie="jidoteki-admin-api-token=; path=/"},s=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},f=function(e){var t;return(t=forge.md.sha256.create()).update(e),t.digest().toHex()},k=function(e,t){var a;return(a=forge.hmac.create()).start("sha256",t),a.update(e),a.digest().toHex()},c=function(e,a){var o,r;return null!=(r=b())?(o=k(`GET${e}`,r),$.get(`${t}${e}?hash=${o}`).done((function(e){return a(null,e)})).fail((function(e){return a(e)}))):a(new Error("Missing or invalid API token"))},g=function(e,a){var o,r;return null!=(r=b())?(o=k(`GET${e}`,r),$(location).attr("href",`${t}${e}?hash=${o}`)):a(new Error("Missing or invalid API token"))},M=function(e,a,o,r){var s,n;return null!=(n=b())?(s=k(`POST${a}`,n),$(`.jido-page-content-${e} .progress .progress-bar`).removeClass("progress-bar-danger"),$(`.jido-page-content-${e} .progress .progress-bar`).removeClass("progress-bar-primary"),$(`.jido-page-content-${e} .progress .progress-bar`).addClass("progress-bar-striped"),$(`.jido-page-content-${e} .progress .progress-bar`).attr("progress-bar-striped",33),$(`.jido-page-content-${e} .progress .progress-bar`).attr("aria-valuenow",33),$(`.jido-page-content-${e} .progress .progress-bar`).html("....uploading, please wait"),$(`.jido-page-content-${e} .progress .progress-bar`).attr("style","width: 33%"),$(`.jido-page-content-${e} .progress`).show(),$.ajax({url:`${t}${a}?hash=${s}`,type:"POST",data:o,processData:!1,contentType:!1,success:function(t,a,o){return B(e),r(null,t)},error:function(t,a,o){return u(e,"upload failed"),r(new Error(o),t)}})):r(new Error("Missing or invalid API token"))},B=function(e){return $(`.jido-page-content-${e} .progress`).show(),$(`.jido-page-content-${e} .progress .progress-bar`).addClass("progress-bar-primary"),$(`.jido-page-content-${e} .progress .progress-bar`).attr("progress-bar-striped",66),$(`.jido-page-content-${e} .progress .progress-bar`).attr("aria-valuenow",66),$(`.jido-page-content-${e} .progress .progress-bar`).html("...updating"),$(`.jido-page-content-${e} .progress .progress-bar`).attr("style","width: 66%")},U=function(e){return $(`.jido-page-content-${e} .progress .progress-bar`).removeClass("progress-bar-striped"),$(`.jido-page-content-${e} .progress .progress-bar`).addClass("progress-bar-success"),$(`.jido-page-content-${e} .progress .progress-bar`).attr("aria-valuenow",100),$(`.jido-page-content-${e} .progress .progress-bar`).html("done"),$(`.jido-page-content-${e} .progress .progress-bar`).attr("style","width: 100%"),$(`.${e}-form`).show(),$(`.${e}-alert`).hide()},u=function(e,t){return $(`.jido-page-content-${e} .progress .progress-bar`).removeClass("progress-bar-striped"),$(`.jido-page-content-${e} .progress .progress-bar`).addClass("progress-bar-danger"),$(`.jido-page-content-${e} .progress .progress-bar`).attr("aria-valuenow",100),$(`.jido-page-content-${e} .progress .progress-bar`).html(validator.escape(t)),$(`.jido-page-content-${e} .progress .progress-bar`).attr("style","width: 100%"),$(`.${e}-form`).show(),$(`.${e}-alert`).hide()},v=function(e,t){return c(`/api/v1/${a}/${e}`,(function(a,o){var r,s;return a?t(new Error(a)):(s="object"==typeof o.status?"":validator.escape(o.status),$(`.jido-data-${e}-status`).html(s),o.log&&$(`.jido-data-${e}-log`).html("object"==typeof o.log?"No log file found":validator.escape(o.log).replace(/\\n/g,"<br/>")),r=function(){switch(s){case"failed":return"label-danger";case"success":return"label-success";case"running":return"label-primary";default:return $(`.jido-data-${e}-status`).html(`waiting for ${e}`),"label-default"}}(),"failed"===s?($(`.jido-page-content-${e} .alert.jido-panel`).addClass("alert-danger"),$(`.jido-page-content-${e} .jido-page-content-${e}-panel`).attr("style","background-color: none")):($(`.jido-page-content-${e} .alert.jido-panel`).removeClass("alert-danger"),$(`.jido-page-content-${e} .jido-page-content-${e}-panel`).attr("style","background-color: #EEEEEE")),o["error-code"]&&o["error-message"]&&"failed"===s?($(`.jido-data-${e}-status-error`).show(),$(`.jido-data-${e}-status-error-message`).html(`${validator.escape(o["error-code"])}: ${validator.escape(o["error-message"])}`)):($(`.jido-data-${e}-status-error`).hide(),$(`.jido-data-${e}-status-error-message`).html("")),$(`.jido-data-${e}-status`).removeClass("label-danger"),$(`.jido-data-${e}-status`).removeClass("label-success"),$(`.jido-data-${e}-status`).removeClass("label-default"),$(`.jido-data-${e}-status`).addClass(r),t(o))}))},O=function(e){var t;return $(`.${e}-form`).hide(),$(`.${e}-alert`).show(),t=setInterval((function(){return v(e,(function(a){if("failed"===a.status)return clearInterval(t),u(e,"failed");if("success"===a.status){if(clearInterval(t),U(e),"backup"===e)return m()}else if("running"===a.status)return B(e)}))}),1e3)},R=function(e){var t;return t=setInterval((function(){return clearInterval(t),$(location).attr("href",e)}),5e3)},o=function(e){return c("/api/v1/admin/version",(function(t,a){return t?(i(),"object"==typeof t.responseJSON&&"boolean"==typeof t.responseJSON["First-Run"]&&$("#new-token").hide(),e(t)):e(null)}))},z=function(){return c("/api/v1/admin/health",(function(e,t){var a,o,r;if(!e)return a=t.cpu.cpu5min>=t.cpu.num?"jido-health-danger":"",o=t.disk.percentage>=98?"jido-health-danger":"",r=t.memory.percentage>=90?"jido-health-danger":"",$("#jido-health-bar").empty(),$("#jido-health-bar").append(`<li class="${a}">cpu ${t.cpu.load} (${t.cpu.num} cores)</li>`),$("#jido-health-bar").append(`<li class="${o}">disk ${t.disk.used} of ${t.disk.total} (${t.disk.percentage}%)</li>`),$("#jido-health-bar").append(`<li class="${r}">memory ${t.memory.used} of ${t.memory.total} (${t.memory.percentage}%)</li>`)}))},W=function(){return c("/api/v1/admin/endpoints",(function(t,a){var o,r,s,n,i;if(!t){for(n=[],o=0,r=e.length;o<r;o++)s=`/api/v1/admin/${i=e[o]}`,X.call(a.endpoints,s)>=0?n.push($(`#jido-button-${i}`).show()):n.push(void 0);return n}}))},h=function(){return $("#jido-page-login").hide(),$(".jido-page-content").hide(),$("#jido-page-navbar").hide(),$("#jido-page-firstrun").show(),$(".jido-page-content-firstrun .jido-panel-network").show(),$(".token-form .token-setuptoken-label").focus(),$(".token-form input.form-control").val("")},T=function(){return $("#jido-page-login").hide(),$(".jido-page-content").hide(),$("#jido-page-navbar .navbar-nav li").removeClass("active"),$("#jido-button-token").addClass("active"),$("#jido-page-navbar").show(),$("#jido-page-token").show(),$(".jido-page-content-token .jido-panel-network").show(),$(".token-form .token-token1-label").focus(),$(".token-form input.form-control").val("")},I=function(){return $("#jido-page-login").hide(),$(".jido-page-content").hide(),$("#jido-page-navbar").hide(),$("#jido-page-token").show(),$(".jido-page-content-token .jido-panel-network").show(),$(".token-form .token-token1-label").focus(),$(".token-form input.form-control").val("")},j=function(){return $(".jido-page-content").hide(),$("#jido-page-navbar").hide(),$("#jido-page-login").show(),$("#login-password").focus()},q=function(){return $("#jido-button-login").click((function(){var e,t;return(e=$("#login-password").val()).length>=0&&e.length<=255&&(t=f(e)),null!=t?(J(t),o((function(e){return e?($("#invalid-token").show(),$("#login-password").focus()):($("#login-password").val(""),$("#invalid-token").hide(),w())}))):($("#invalid-token").show(),$("#login-password").focus())}))},F=function(){return $("#new-token").click((function(){return I()}))},K=function(){return $("#jido-button-token-upload").click((function(){var e,t,a,o,r;return $(".token-form .token-token1-label").parent().removeClass("has-error"),$(".token-form .token-token2-label").parent().removeClass("has-error"),t=$("#token1-input").val(),a=$("#token2-input").val(),t?(o=zxcvbn(t,["password12","password@1","password@12","password@123"]),t.length>8&&t.length<=255?o.score>=2?a?t!==a?($(".token-alert").html("API Token mismatch. Please verify the API Token."),void $(".token-alert").show()):(r=f(t),(e=new FormData).append("newtoken",t),e?($(".jido-page-content-token .jido-panel").show(),M("token","/api/v1/admin/setup",e,(function(e,t){return e?($(".jido-data-token-status").html("failed"),$(".jido-data-token-status").removeClass("label-danger"),$(".jido-data-token-status").removeClass("label-success"),$(".jido-data-token-status").removeClass("label-default"),$(".jido-data-token-status").addClass("label-danger"),u("token")):($(".jido-data-token-status").html("changed"),$(".jido-data-token-status").removeClass("label-danger"),$(".jido-data-token-status").removeClass("label-success"),$(".jido-data-token-status").removeClass("label-default"),$(".jido-data-token-status").addClass("label-success"),$(".token-alert").hide(),J(r),U("token"),$("#token1-input").val(""),$("#token2-input").val(""),$(".jido-page-content-token .jido-panel-network").hide(),T())}))):void 0):($(".token-form .token-token2-label").parent().addClass("has-error"),$(".token-form .token-token2-label").html("Confirm API Token (required)"),void $(".token-form .token-token2-label").focus()):($(".token-alert").html(`API Token is too weak. ${o.feedback.warning}`),$(".token-alert").show(),$(".token-form .token-token1-label").parent().addClass("has-error"),$(".token-form .token-token1-label").html("API Token (required)"),void $(".token-form .token-token1-label").focus()):($(".token-alert").html("Invalid API Token. Must be between 8 and 255 characters"),$(".token-alert").show(),$(".token-form .token-token1-label").parent().addClass("has-error"),$(".token-form .token-token1-label").html("API Token (required)"),void $(".token-form .token-token1-label").focus())):($(".token-form .token-token1-label").parent().addClass("has-error"),$(".token-form .token-token1-label").html("API Token (required)"),void $(".token-form .token-token1-label").focus())}))},G=function(){return $("#jido-button-firstrun-upload").click((function(){var e,t,a,o,r,s,n;return $(".token-form .token-token1-label").parent().removeClass("has-error"),$(".token-form .token-token2-label").parent().removeClass("has-error"),r=$("#setuptoken-input").val(),t=$("#setuptoken1-input").val(),a=$("#setuptoken2-input").val(),r?t?(o=zxcvbn(t,["password12","password@1","password@12","password@123"]),t.length>8&&t.length<=255?o.score>=2?a?t!==a?($(".token-alert").html("API Token mismatch. Please verify the API Token."),void $(".token-alert").show()):(n=f(t),(e=new FormData).append("newtoken",t),e?(s=f(r),J(s),$(".jido-page-content-firstrun .jido-panel").show(),M("firstrun","/api/v1/admin/setup",e,(function(e,t){return e?($(".jido-data-firstrun-status").html("failed"),$(".jido-data-firstrun-status").removeClass("label-danger"),$(".jido-data-firstrun-status").removeClass("label-success"),$(".jido-data-firstrun-status").removeClass("label-default"),$(".jido-data-firstrun-status").addClass("label-danger"),u("firstrun")):($(".jido-data-firstrun-status").html("changed"),$(".jido-data-firstrun-status").removeClass("label-danger"),$(".jido-data-firstrun-status").removeClass("label-success"),$(".jido-data-firstrun-status").removeClass("label-default"),$(".jido-data-firstrun-status").addClass("label-success"),$(".token-alert").hide(),J(n),U("firstrun"),$("#setuptoken-input").val(""),$("#setuptoken1-input").val(""),$("#setuptoken2-input").val(""),$(".jido-page-content-firstrun .jido-panel-network").hide(),w())}))):void 0):($(".token-form .token-token2-label").parent().addClass("has-error"),$(".token-form .token-token2-label").html("Confirm API Token (required)"),void $(".token-form .token-token2-label").focus()):($(".token-alert").html(`API Token is too weak. ${o.feedback.warning}`),$(".token-alert").show(),$(".token-form .token-token1-label").parent().addClass("has-error"),$(".token-form .token-token1-label").html("API Token (required)"),void $(".token-form .token-token1-label").focus()):($(".token-alert").html("Invalid API Token. Must be between 8 and 255 characters"),$(".token-alert").show(),$(".token-form .token-token1-label").parent().addClass("has-error"),$(".token-form .token-token1-label").html("API Token (required)"),void $(".token-form .token-token1-label").focus())):($(".token-form .token-token1-label").parent().addClass("has-error"),$(".token-form .token-token1-label").html("API Token (required)"),void $(".token-form .token-token1-label").focus()):($(".token-form .token-setuptoken-label").parent().addClass("has-error"),$(".token-form .token-setuptoken-label").html("Setup Token (required)"),void $(".token-form .token-setuptoken-label").focus())}))},function(){$("#jido-button-logout").click((function(){return i(),location.reload()}))}(),q(),F(),K(),G(),a="admin",e=["settings","certs","license","storage","backup"],w=function(){return $("#jido-page-login").hide(),$(".jido-page-content").hide(),$("#jido-page-navbar .navbar-nav li").removeClass("active"),$("#jido-button-home").addClass("active"),$("#jido-page-navbar").show(),$("#jido-page-dashboard").show(),c("/api/v1/admin/version",(function(e,t){if(!e)return $(".jido-data-platform-version").html(validator.escape(t.version))})),z(),W(),c("/api/v1/admin/settings",(function(e,t){var a,o,r;if(!e)return o=function(){var e,o;for(a in o=[],e=t.network)r=e[a],"ip_address"===a&&(a="IP address"),"dns1"===a&&(a="DNS 1"),"dns2"===a&&(a="DNS 2"),"ntpserver"===a&&(a="NTP Server"),"object"==typeof r&&(r=""),o.push(`<li class="list-group-item">${s(a)} <span class="pull-right text-primary">${validator.escape(r)}</span></li>`);return o}(),$(".jido-data-network-info").html(o)})),c("/api/v1/admin/changelog",(function(e,t){if(!e)return $(".jido-data-changelog").html(validator.escape(t))})),c("/api/v1/admin/services",(function(e,t){var a,o,r,s,n,i,d;if(!e){for(i="",a=0,r=(s=t.services).length;a<r;a++)for(o in n=s[a])i+="running"===(d=n[o])?`<li class="list-group-item"><i class="fa icon-ok-circled text-success"></i> ${validator.escape(o)} <span class="pull-right text-success">${validator.escape(d)}</span></li>`:`<li class="list-group-item"><i class="fa icon-cancel-circled text-danger"></i> ${validator.escape(o)} <span class="pull-right text-danger">${validator.escape(d)}</span></li>`;return $(".jido-data-services-info").html(i)}}))},S=function(e){return $("#jido-page-login").hide(),$(".jido-page-content").hide(),$("#jido-page-navbar .navbar-nav li").removeClass("active"),$(`#jido-button-${e}`).addClass("active"),$("#jido-page-navbar").show(),$(`.jido-page-content-${e}`).show(),c("/api/v1/admin/version",(function(e,t){if(!e)return $(".jido-data-platform-version").html(validator.escape(t.version))})),v(e,(function(t){if("running"===t.status)return O(e)}))},C=function(){return $("#jido-page-login").hide(),$(".jido-page-content").hide(),$("#jido-page-navbar .navbar-nav li").removeClass("active"),$("#jido-button-settings").addClass("active"),$("#jido-page-navbar").show(),$("#jido-page-network").show(),c("/api/v1/admin/version",(function(e,t){if(!e)return $(".jido-data-platform-version").html(validator.escape(t.version))})),c("/api/v1/admin/settings",(function(e,t){var a,o,r;if(!e)return $(".network-form input.form-control").val(""),null==t.network.interface&&$("#interface-input").val("eth0"),"dhcp"===t.network.mode?($("#network-type-dhcp").prop("checked",!0),$("#network-type-static").prop("checked",!1),$("#ip_address-input").prop("disabled",!0),$("#netmask-input").prop("disabled",!0),$("#gateway-input").prop("disabled",!0)):($("#network-type-dhcp").prop("checked",!1),$("#network-type-static").prop("checked",!0),$("#ip_address-input").prop("disabled",!1),$("#netmask-input").prop("disabled",!1),$("#gateway-input").prop("disabled",!1)),o=function(){var e,o;for(a in o=[],e=t.network)"object"==typeof(r=e[a])&&(r=""),$(`#${a}-input`).val(r),o.push(`<li class="list-group-item">${s(a)} <span class="pull-right label label-primary">${validator.escape(r)}</span></li>`);return o}(),$(".jido-data-network-info").html(o)}))},P=function(){return $("#jido-page-login").hide(),$(".jido-page-content").hide(),$("#jido-page-navbar .navbar-nav li").removeClass("active"),$("#jido-button-storage").addClass("active"),$("#jido-page-navbar").show(),$("#jido-page-storage").show(),c("/api/v1/admin/version",(function(e,t){if(!e)return $(".jido-data-platform-version").html(validator.escape(t.version))})),c("/api/v1/admin/storage",(function(e,t){var a,o,r;if(!e){if($(".storage-form input.form-control").val(""),o=function(){var e,a,o,s;for(s=[],e=0,a=(o=t.options).length;e<a;e++)switch(r=o[e],$(`#storage-help-${r}`).show(),r){case"local":s.push("<option value='local')>Local (disk)</option>");break;case"nfs":s.push("<option value='nfs'>NFS</option>");break;case"aoe":s.push("<option value='aoe'>AoE (ATA-over-Ethernet)</option>");break;case"iscsi":s.push("<option value='iscsi'>iSCSI</option>");break;case"nbd":s.push("<option value='nbd'>NBD</option>");break;default:s.push(void 0)}return s}(),$("#storage-name-select").html(o),!(t.storage.type&&(a=t.storage.type,X.call(t.options,a)>=0)))return $("#storage-name-select option[value=local]").attr("selected",!0);switch($(`#storage-name-select option[value=${t.storage.type}]`).attr("selected",!0),$(`#storage-${t.storage.type}`).show(),t.storage.type){case"nfs":return $(`#storage-${t.storage.type} .mount-input`).val(validator.escape(t.storage.mount_options)),$(`#storage-${t.storage.type} .ip-input`).val(validator.escape(t.storage.ip)),$(`#storage-${t.storage.type} .share-input`).val(validator.escape(t.storage.share));case"aoe":return $(`#storage-${t.storage.type} .device-input`).val(validator.escape(t.storage.device));case"iscsi":return $(`#storage-${t.storage.type} .ip-input`).val(validator.escape(t.storage.ip)),$(`#storage-${t.storage.type} .target-input`).val(validator.escape(t.storage.target)),$(`#storage-${t.storage.type} .username-input`).val(validator.escape(t.storage.username)),$(`#storage-${t.storage.type} .password-input`).val(validator.escape(t.storage.password));case"nbd":return $(`#storage-${t.storage.type} .ip-input`).val(validator.escape(t.storage.ip)),$(`#storage-${t.storage.type} .port-input`).val(validator.escape(t.storage.port)),$(`#storage-${t.storage.type} .export-input`).val(validator.escape(t.storage.export))}}}))},A=function(){return $("#jido-page-login").hide(),$(".jido-page-content").hide(),$("#jido-page-navbar .navbar-nav li").removeClass("active"),$("#jido-button-support").addClass("active"),$("#jido-page-navbar").show(),$("#jido-page-support").show(),c("/api/v1/admin/version",(function(e,t){if(!e)return $(".jido-data-platform-version").html(validator.escape(t.version))}))},y=function(){return $("#jido-page-login").hide(),$(".jido-page-content").hide(),$("#jido-page-navbar .navbar-nav li").removeClass("active"),$("#jido-button-monitor").addClass("active"),$("#jido-page-navbar").show(),$("#jido-page-monitor").show(),c("/api/v1/admin/version",(function(e,t){if(!e)return $(".jido-data-platform-version").html(validator.escape(t.version)),_("1h")}))},m=function(){return $("#jido-page-login").hide(),$(".jido-page-content").hide(),$("#jido-page-navbar .navbar-nav li").removeClass("active"),$("#jido-button-backup").addClass("active"),$("#jido-page-navbar").show(),$("#jido-page-backup").show(),c("/api/v1/admin/version",(function(e,t){if(!e)return $(".jido-data-platform-version").html(validator.escape(t.version))})),v("backup",(function(e){return"running"===e.status?O("backup"):"success"===e.status?($("#backupInfo").show(),$("#jido-button-backup-stop").show(),$("#jido-page-backup pre.backup-status-filesize").html(validator.escape(e.filesize)),$("#jido-page-backup pre.backup-status-sha256").html(validator.escape(e.sha256))):($("#backupInfo").hide(),$("#jido-button-backup-stop").hide())}))},_=function(e){var t;return t=function(e){switch(e){case"1h":return p("-1h");default:return p("-1d");case"1w":return p("-1w");case"1m":return p("-1m");case"1y":return p("-1y")}},$("#jido-monitor-duration li").removeClass("active"),$(`.jido-duration-${e}`).addClass("active"),$("#jido-page-monitor p .jido-monitor-msg").fadeIn(500,(function(){return t(e)}))},p=function(e){var t;return t=`-s ${e}`,draw("svgload","load",t),draw("svgmemory","memory",t),draw("svgnetwork","if_octets",t),draw("svgdisk","disk",t),$("#jido-page-monitor p .jido-monitor-msg").fadeOut(2e3)},E=function(){return $("#jido-button-network-upload").click((function(){var e,t,a,o,r;if((o=new Object).app={},o.network={},o.network.hostname=$("#hostname-input").val(),o.network.interface=$("#interface-input").val(),o.network.ip_address=$("#ip_address-input").val(),o.network.netmask=$("#netmask-input").val(),o.network.gateway=$("#gateway-input").val(),o.network.ntpserver=$("#ntpserver-input").val(),$("#dns1-input").val()&&(o.network.dns1=$("#dns1-input").val()),$("#dns2-input").val()&&(o.network.dns2=$("#dns2-input").val()),r=$("#network-type-dhcp").is(":checked")?"dhcp":"static",!o.network.hostname||!validator.isFQDN(o.network.hostname,{require_tld:!1}))return $(".network-form .network-hostname-label").parent().addClass("has-error"),$(".network-form .network-hostname-label").html("Hostname (required)"),void $(".network-form .network-hostname-label").focus();if(!o.network.interface||!validator.isAlphanumeric(o.network.interface))return $(".network-form .network-interface-label").parent().addClass("has-error"),$(".network-form .network-interface-label").html("Interface (required)"),void $(".network-form .network-interface-label").focus();if(o.network.ntpserver&&!validator.isFQDN(o.network.ntpserver)&&!validator.isIP(o.network.ntpserver))return $(".network-form .network-ntpserver-label").parent().addClass("has-error"),$(".network-form .network-ntpserver-label").html("NTP Server (required)"),void $(".network-form .network-ntpserver-label").focus();if($(".jido-data-network-status").removeClass("label-danger"),$(".jido-data-network-status").removeClass("label-success"),$(".jido-data-network-status").removeClass("label-default"),"static"===r){if(!validator.isIP(o.network.ip_address))return $(".network-form .network-ip_address-label").parent().addClass("has-error"),void $(".network-form .network-ip_address-label").focus();if(!validator.isIP(o.network.netmask)&&!validator.isInt(o.network.netmask.replace("/",""),{min:1,max:128}))return $(".network-form .network-netmask-label").parent().addClass("has-error"),void $(".network-form .network-netmask-label").focus();if(!validator.isIP(o.network.gateway))return $(".network-form .network-gateway-label").parent().addClass("has-error"),void $(".network-form .network-gateway-label").focus();if(o.network.dns1&&!validator.isIP(o.network.dns1))return $(".network-form .network-dns1-label").parent().addClass("has-error"),void $(".network-form .network-dns1-label").focus();if(o.network.dns2&&!validator.isIP(o.network.dns2))return $(".network-form .network-dns2-label").parent().addClass("has-error"),void $(".network-form .network-dns2-label").focus();$(".jido-data-network-status").html("STATIC"),$(".jido-data-network-status").addClass("label-success")}else $(".jido-data-network-status").html("DHCP"),$(".jido-data-network-status").addClass("label-success"),delete o.network.ip_address,delete o.network.netmask,delete o.network.gateway,delete o.network.dns1,delete o.network.dns2;return a=new FormData,t=JSON.stringify(o),(e=new Blob([t],{type:"application/json"})).lastModifiedDate=new Date,a.append("settings",e,"settings.json"),a?($(".jido-page-content-network .jido-panel").show(),M("network","/api/v1/admin/settings",a,(function(e,t){var a,r;if(!e)return U("network"),o.network.ip_address?(a=validator.isIP(o.network.ip_address,4)?o.network.ip_address:`[${o.network.ip_address}]`,r=`${window.location.protocol}//${a}${null!=window.location.port?":"+window.location.port:""}`,$(".network-alert").html(`Redirecting to <a href="${r}">${r}</a> in 5 seconds`),$(".network-alert").show(),R(r)):C()}))):void 0}))},n=function(){return $("#jido-button-certs-upload").click((function(){var e;if((e=new FormData).append("public",$("#public-key-input[type=file]")[0].files[0]),e.append("private",$("#private-key-input[type=file]")[0].files[0]),$("#ca-key-input[type=file]")[0].files[0]&&e.append("ca",$("#ca-key-input[type=file]")[0].files[0]),e)return $(".jido-page-content-certs .jido-panel").show(),M("certs","/api/v1/admin/certs",e,(function(e,t){if(!e)return O("certs")}))}))},V=function(e){return $(`#jido-button-${e}-fulllog`).click((function(){return c(`/api/v1/admin/${e}/log`,(function(t,a){if(!t)return $(`#jido-button-${e}-fulllog`).addClass("active"),$(`.jido-data-${e}-full-log`).parent().show(),$(`.jido-data-${e}-full-log`).html(a?validator.escape(a):"No log file found")}))}))},x=function(){return $("#jido-data-logs-files").click((function(){return g("/api/v1/admin/logs",(function(e){}))}))},d=function(){return $("#jido-data-debug-files").click((function(){return g("/api/v1/admin/debug",(function(e){}))}))},H=function(){return $("#jido-button-restart-confirm").click((function(){return c("/api/v1/admin/reboot",(function(e){e||$(".restart-alert").show()}))}))},D=function(){return $("#jido-monitor-duration li a").click((function(){var e;return e=$(this).attr("duration"),_(e)}))},L=function(){return $("#jido-button-storage-upload").click((function(){var e,t,a,o;switch((o=new Object).storage={},o.storage.type=$("#storage-name-select").val(),o.storage.type){case"nfs":if(o.storage.ip=$(`#storage-${o.storage.type} .ip-input`).val(),o.storage.mount_options=$(`#storage-${o.storage.type} .mount-input`).val(),o.storage.share=$(`#storage-${o.storage.type} .share-input`).val(),!o.storage.ip||!validator.isIP(o.storage.ip))return $(`#storage-${o.storage.type} .storage-ip-label`).parent().addClass("has-error"),$(`#storage-${o.storage.type} .storage-ip-label`).html("IP address (required)"),void $(`#storage-${o.storage.type} .ip-input`).focus();if(!o.storage.share||!validator.isWhitelisted(o.storage.share,"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789._-/"))return $(`#storage-${o.storage.type} .storage-share-label`).parent().addClass("has-error"),$(`#storage-${o.storage.type} .storage-share-label`).html("Share path (required)<br/>Allowed: abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789._-/"),void $(`#storage-${o.storage.type} .share-input`).focus();if(!o.storage.mount_options||!validator.isWhitelisted(o.storage.mount_options,"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789=,.-"))return $(`#storage-${o.storage.type} .storage-mount-label`).parent().addClass("has-error"),$(`#storage-${o.storage.type} .storage-mount-label`).html("Mount options (required)<br/>Allowed: abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789=,.-"),void $(`#storage-${o.storage.type} .mount-input`).focus();break;case"aoe":if(o.storage.device=$(`#storage-${o.storage.type} .device-input`).val(),!o.storage.device||!validator.isWhitelisted(o.storage.device,"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789."))return $(`#storage-${o.storage.type} .storage-device-label`).parent().addClass("has-error"),$(`#storage-${o.storage.type} .storage-device-label`).html("Device (required)<br/>Allowed: abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789."),void $(`#storage-${o.storage.type} .device-input`).focus();break;case"iscsi":if(o.storage.ip=$(`#storage-${o.storage.type} .ip-input`).val(),o.storage.target=$(`#storage-${o.storage.type} .target-input`).val(),o.storage.username=$(`#storage-${o.storage.type} .username-input`).val(),o.storage.password=$(`#storage-${o.storage.type} .password-input`).val(),!o.storage.ip||!validator.isIP(o.storage.ip))return $(`#storage-${o.storage.type} .storage-ip-label`).parent().addClass("has-error"),$(`#storage-${o.storage.type} .storage-ip-label`).html("IP address (required)"),void $(`#storage-${o.storage.type} .ip-input`).focus();if(!o.storage.target||!validator.isWhitelisted(o.storage.target,"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789._-:"))return $(`#storage-${o.storage.type} .storage-target-label`).parent().addClass("has-error"),$(`#storage-${o.storage.type} .storage-target-label`).html("Target (required)<br/>Allowed: abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789._-:"),void $(`#storage-${o.storage.type} .target-input`).focus();if(!o.storage.username||!validator.isAscii(o.storage.username))return $(`#storage-${o.storage.type} .storage-username-label`).parent().addClass("has-error"),$(`#storage-${o.storage.type} .storage-username-label`).html("Username (required)<br/>Allowed: ASCII characters"),void $(`#storage-${o.storage.type} .username-input`).focus();if(!o.storage.password||!validator.isAscii(o.storage.password))return $(`#storage-${o.storage.type} .storage-password-label`).parent().addClass("has-error"),$(`#storage-${o.storage.type} .storage-password-label`).html("Password (required)<br/>Allowed: ASCII characters"),void $(`#storage-${o.storage.type} .password-input`).focus();break;case"nbd":if(o.storage.ip=$(`#storage-${o.storage.type} .ip-input`).val(),o.storage.port=$(`#storage-${o.storage.type} .port-input`).val(),o.storage.export_name=$(`#storage-${o.storage.type} .export-input`).val(),!o.storage.ip||!validator.isIP(o.storage.ip))return $(`#storage-${o.storage.type} .storage-ip-label`).parent().addClass("has-error"),$(`#storage-${o.storage.type} .storage-ip-label`).html("IP address (required)"),void $(`#storage-${o.storage.type} .ip-input`).focus();if(!o.storage.port||!validator.isNumeric(o.storage.port))return $(`#storage-${o.storage.type} .storage-port-label`).parent().addClass("has-error"),$(`#storage-${o.storage.type} .storage-port-label`).html("Port (required)"),void $(`#storage-${o.storage.type} .port-input`).focus();if(!o.storage.export_name||!validator.isWhitelisted(o.storage.export_name,"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789._-/"))return $(`#storage-${o.storage.type} .storage-export-label`).parent().addClass("has-error"),$(`#storage-${o.storage.type} .storage-export-label`).html("Export name (required)<br/>Allowed: abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789._-/"),void $(`#storage-${o.storage.type} .export-input`).focus()}if(a=new FormData,t=JSON.stringify(o),(e=new Blob([t],{type:"application/json"})).lastModifiedDate=new Date,a.append("settings",e,"settings.json"),a)return $(".jido-page-content-storage .jido-panel").show(),M("storage","/api/v1/admin/storage",a,(function(e,t){if(!e)return U("storage"),$(".storage-alert").html("Please Restart to apply storage settings."),$(".storage-alert").show()}))}))},Q=function(){return $("#storage-name-select").change((function(){var e;return e=$(this).val(),$(".storage-form-options").hide(),$(`#storage-${e}`).show()}))},r=function(){return $("#jido-button-backup-start").click((function(){var e;if((e=new FormData).append("action","START"),e)return $(".backup-alert").html("The backup will complete shortly."),$(".jido-page-content-backup .jido-panel").show(),M("backup","/api/v1/admin/backup",e,(function(e,t){return e?($(".jido-data-backup-status").html("failed"),$(".jido-data-backup-status").removeClass("label-danger"),$(".jido-data-backup-status").removeClass("label-success"),$(".jido-data-backup-status").removeClass("label-default"),$(".jido-data-backup-status").addClass("label-danger")):($(".jido-data-backup-status").removeClass("label-danger"),$(".jido-data-backup-status").removeClass("label-success"),$(".jido-data-backup-status").removeClass("label-default"),$(".jido-data-backup-status").addClass("label-success"),m())}))})),$("#jido-button-backup-stop").click((function(){var e;if((e=new FormData).append("action","STOP"),e)return $(".jido-page-content-backup .jido-panel").show(),M("backup","/api/v1/admin/backup",e,(function(e,t){return e?($(".jido-data-backup-status").html("failed"),$(".jido-data-backup-status").removeClass("label-danger"),$(".jido-data-backup-status").removeClass("label-success"),$(".jido-data-backup-status").removeClass("label-default"),$(".jido-data-backup-status").addClass("label-danger")):($(".jido-data-backup-status").html("backup canceled"),$(".jido-data-backup-status").removeClass("label-danger"),$(".jido-data-backup-status").removeClass("label-success"),$(".jido-data-backup-status").removeClass("label-default"),$(".jido-data-backup-status").addClass("label-success"),U("backup"),m())}))})),$("#jido-data-backup-file").click((function(){return g("/api/v1/admin/backup/download",(function(e){}))})),$("#jido-button-backup-upload").click((function(){var e;if((e=new FormData).append("archive",$("#backup-restore-input[type=file]")[0].files[0]),e)return $(".jido-page-content-backup .jido-panel").show(),M("backup","/api/v1/admin/backup/restore",e,(function(e,t){return e?($(".jido-data-backup-status").html("failed"),$(".jido-data-backup-status").removeClass("label-danger"),$(".jido-data-backup-status").removeClass("label-success"),$(".jido-data-backup-status").removeClass("label-default"),$(".jido-data-backup-status").addClass("label-danger")):($(".jido-data-backup-status").html("backup restored"),$(".jido-data-backup-status").removeClass("label-danger"),$(".jido-data-backup-status").removeClass("label-success"),$(".jido-data-backup-status").removeClass("label-default"),$(".jido-data-backup-status").addClass("label-success")),$(".jido-page-content-backup .progress").hide()}))}))},l=function(){return $("#network-type-dhcp").change((function(){return $("#ip_address-input").prop("disabled",!0),$("#netmask-input").prop("disabled",!0),$("#gateway-input").prop("disabled",!0)})),$("#network-type-static").change((function(){return $("#ip_address-input").prop("disabled",!1),$("#netmask-input").prop("disabled",!1),$("#gateway-input").prop("disabled",!1)}))},N=function(){return $("#jido-page-navbar .navbar-nav li a").click((function(){switch($(this).parent().attr("id")){case"jido-button-home":w();break;case"jido-button-update":S("update");break;case"jido-button-settings":C();break;case"jido-button-certs":S("certs");break;case"jido-button-license":loadLicense();break;case"jido-button-storage":P();break;case"jido-button-token":T();break;case"jido-button-support":A();break;case"jido-button-monitor":y();break;case"jido-button-backup":m()}return z()}))},function(){$("#jido-button-update-upload").click((function(){var e;if((e=new FormData).append("update",$("#update-input[type=file]")[0].files[0]),e)return $(".jido-page-content-update .jido-panel").show(),M("update","/api/v1/admin/update",e,(function(e,t){if(!e)return O("update")}))}))}(),E(),n(),V("update"),x(),d(),H(),D(),L(),Q(),r(),l(),N(),o((function(e){return e&&"object"==typeof e.responseJSON&&!0===e.responseJSON["First-Run"]?h():e&&"object"==typeof e.responseJSON&&!1===e.responseJSON["First-Run"]||e?j():w()}))}).call(this);
